{% if (parameters.enableReturns and orderData.shipments | length) or orderData.returns | length %}
	<ul class="pull-right text-right list-unstyled">
		{% if parameters.enableReturns and orderData.shipments | length %}
			<li>
				<a href="{{ functionURL('Rbs_Productreturn_ReturnProcess', {'orderId': orderData.common.id}) }}" class="btn btn-default">
					{{ i18n('m.rbs.productreturn.front.make_a_return', ['ucf']) }}
				</a>
			</li>
		{% endif %}
		{% if orderData.returns | length %}
			<li>
				<a href="javascript:;" data-rbs-anchor="return-list-{{ blockId }}">
					{{ i18n('m.rbs.productreturn.front.follow_a_return', ['ucf']) }}
				</a>
			</li>
		{% endif %}
	</ul>
{% endif %}

<h1>{{ i18n('m.rbs.order.front.order_details', ['ucf']) }}</h1>

<div class="clearfix"></div>

<div class="row no-bottom-margin">
	<div class="col-md-6">
		<div class="panel panel-default">
			<div class="panel-heading">
				<h2 class="panel-title">
					<span class="glyphicon glyphicon-info-sign"></span>
					{{ i18n('m.rbs.order.front.order_general_information', ['ucf']) }}
				</h2>
			</div>
			<dl class="dl-horizontal">
				{% if order.code %}
				<dt>{{ i18n('m.rbs.order.front.order_number', ['ucf']) }}</dt>
				<dd>{{ order.code }}</dd>
				{% endif %}
				<dt>{{ i18n('m.rbs.order.front.order_date', ['ucf']) }}</dt>
				<dd>{{ order.date | transDateTime }}</dd>
				<dt>{{ i18n('m.rbs.order.front.order_processing_status', ['ucf']) }}</dt>
				<dd{% if order.processingStatus == 'canceled' %} class="text-warning"{% endif %}>
					{{ order.statusTitle }}
				</dd>
			</dl>
		</div>
	</div>
	<div class="col-md-6">
		<div class="panel panel-default">
			<div class="panel-heading">
				<h2 class="panel-title">
					<span class="glyphicon glyphicon-user"></span>
					{{ i18n('m.rbs.order.front.order_personal_information', ['ucf']) }}
				</h2>
			</div>
			<div class="panel-body">
				<p>
					<a href="mailto:{{ order.email }}">{{ order.email }}</a>
				</p>
				{% set lines = order.address.lines %}
				<address class="no-bottom-margin">
					<strong>{{ lines[0] }}</strong>
					{% for line in lines %}
						{% if not loop.first %}<br />{{ line }}{% endif %}
					{% endfor %}
				</address>
			</div>
		</div>
	</div>
</div>

<div class="panel panel-default">
	<div class="panel-heading">
		<h2 class="panel-title">
			<span class="glyphicon glyphicon-shopping-cart"></span>
			{{ i18n('m.rbs.order.front.order_lines', ['ucf']) }}
		</h2>
	</div>
	<div class="table-responsive">
		<table class="table table-striped table-vertical-middle no-bottom-margin">
			<thead>
				<tr>
					<th>#</th>
					<th>{{ i18n('m.rbs.commerce.front.designation', ['ucf']) }}</th>
					{% if parameters.displayPricesWithoutTax or parameters.displayPricesWithTax %}
						<th>{{ i18n('m.rbs.commerce.front.unit_price', ['ucf']) }}</th>
					{% endif %}
					<th>{{ i18n('m.rbs.commerce.front.quantity', ['ucf']) }}</th>
					{% if parameters.displayPricesWithoutTax or parameters.displayPricesWithTax %}
						<th>{{ i18n('m.rbs.commerce.front.total_price', ['ucf']) }}</th>
					{% endif %}
				</tr>
			</thead>
			<tbody>
				{% for line in order.lines %}
					<tr>
						<td>{{ loop.index }}</td>
						<td>{{ line.designation }}</td>
						{% if parameters.displayPricesWithoutTax or parameters.displayPricesWithTax %}
							<td class="price">
								{% if parameters.displayPricesWithoutTax %}
									{{ formatPrice(line.unitAmount, order.currencyCode) }}
									<abbr class="tax-mode" title="{{ i18nAttr('m.rbs.catalog.front.without_tax') }}">{{ i18n('m.rbs.catalog.front.without_tax_abbr') }}</abbr>
								{% endif %}
								{% if parameters.displayPricesWithoutTax and parameters.displayPricesWithTax %}<br />{% endif %}
								{% if parameters.displayPricesWithTax %}
									{{ formatPrice(line.unitAmountWithTaxes, order.currencyCode) }}
									<abbr class="tax-mode" title="{{ i18nAttr('m.rbs.catalog.front.with_tax') }}">{{ i18n('m.rbs.catalog.front.with_tax_abbr') }}</abbr>
								{% endif %}
							</td>
						{% endif %}
						<td class="form-inline">{{ line.quantity }}</td>
						{% if parameters.displayPricesWithoutTax or parameters.displayPricesWithTax %}
							<td class="price">
								{% if parameters.displayPricesWithoutTax %}
									{{ formatPrice(line.amount, order.currencyCode)}}
									<abbr class="tax-mode" title="{{ i18nAttr('m.rbs.catalog.front.without_tax') }}">{{ i18n('m.rbs.catalog.front.without_tax_abbr') }}</abbr>
								{% endif %}
								{% if parameters.displayPricesWithoutTax and parameters.displayPricesWithTax %}<br />{% endif %}
								{% if parameters.displayPricesWithTax %}
									{{ formatPrice(line.amountWithTaxes, order.currencyCode) }}
									<abbr class="tax-mode" title="{{ i18nAttr('m.rbs.catalog.front.with_tax') }}">{{ i18n('m.rbs.catalog.front.with_tax_abbr') }}</abbr>
								{% endif %}
							</td>
						{% endif %}
					</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>
</div>

<div class="panel panel-default">
	<div class="panel-heading">
		<h2 class="panel-title">
			<span class="glyphicon glyphicon-plane"></span>
			{{ i18n('m.rbs.commerce.front.process_step_shipping', ['ucf']) }}
		</h2>
	</div>
	<div class="table-responsive">
		<table class="table table-striped table-vertical-middle no-bottom-margin">
			<thead>
				<tr>
					<th>{{ i18n('m.rbs.order.front.shipping_mode', ['ucf']) }}</th>
					{% if (order.shippingModes|length) > 1 %}
						<th>{{ i18n('m.rbs.order.front.shipping_articles', ['ucf']) }}</th>
					{% endif %}
					<th>{{ i18n('m.rbs.order.front.shipping_status', ['ucf']) }}</th>
					<th>{{ i18n('m.rbs.order.front.shipping_address', ['ucf']) }}</th>
				</tr>
			</thead>
			<tbody>
				{% for shippingMode in order.shippingModes %}
					<tr>
						<td>{{ shippingMode.title }}</td>
						{% if (order.shippingModes|length) > 1 %}
							<td>
								{% for line in order.lines %}
									{% if line.key in shippingMode.lineKeys %}
										{{ line.designation }} ({{ i18n('m.rbs.order.front.shipping_line') }} {{ loop.index }})<br />
									{% endif %}
								{% endfor %}
							</td>
						{% endif %}
						<td>
							{% set status = order.shippingModesStatuses[shippingMode.id] | lower %}
							{{ i18n('m.rbs.order.front.shipping_status_' ~ status, ['ucf']) }}
						</td>
						<td>
							{% if shippingMode.address.lines|length %}
								{% set lines = shippingMode.address.lines %}
								<address class="no-bottom-margin">
									<strong>{{ lines[0] }}</strong>
									{% for line in lines %}
										{% if not loop.first %}<br />{{ line }}{% endif %}
									{% endfor %}
								</address>
							{% else %}
								-
							{% endif %}
						</td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>
</div>

<div class="row no-bottom-margin">
	<div class="col-md-6">
		<div class="panel panel-default">
			<div class="panel-heading">
				<h2 class="panel-title">
					{{ i18n('m.rbs.commerce.front.taxes_amount', ['ucf']) }}
				</h2>
			</div>
			<table class="table table-striped table-bordered">
				<tbody>
					{% for tax in order.totalTaxes %}
						<tr>
							<td>{{ taxTitle(tax.taxCode) }} ({{ formatRate(tax.rate) }})</td>
							<td class="price">{{ formatPrice(tax.value, order.currencyCode) }}</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
	<div class="col-md-6">
		<div class="panel panel-default">
			<div class="panel-heading">
				<h2 class="panel-title">
					{{ i18n('m.rbs.commerce.front.summary_of_amounts', ['ucf']) }}
				</h2>
			</div>
			<table class="table table-striped table-bordered">
				<tbody>
					{% if order.fees | length or order.discounts | length %}
						<tr>
							<td>{{ i18n('m.rbs.commerce.front.lines_amount_with_tax', ['ucf']) }}</td>
							<td class="price">{{ formatPrice(order.linesAmountWithTaxes, order.currencyCode) }}</td>
						</tr>
					{% endif %}
					{% for fee in order.fees %}
						<tr>
							<td>{{ fee.designation }}</td>
							<td class="price">{{ formatPrice(fee.amountWithTaxes, order.currencyCode) }}</td>
						</tr>
					{% endfor %}
					{% for discount in order.discounts %}
						<tr>
							<td>{{ discount.title }}</td>
							<td class="price">{{ formatPrice(discount.amountWithTaxes, order.currencyCode) }}</td>
						</tr>
					{% endfor %}
					{% if order.creditNotes | length %}
						<tr>
							<td>{{ i18n('m.rbs.commerce.front.total_amount_with_tax', ['ucf']) }}</td>
							<td class="price">{{ formatPrice(order.totalAmountWithTaxes, order.currencyCode) }}</td>
						</tr>
						<tr>
							<td>{{ i18n('m.rbs.commerce.front.credit_notes_total_amounts', ['ucf']) }}</td>
							<td class="price">{{ formatPrice(order.totalCreditNotesAmount, order.currencyCode) }}</td>
						</tr>
					{% endif %}
					<tr>
						<td><strong>{{ i18n('m.rbs.commerce.front.amount_to_pay', ['ucf']) }}</strong></td>
						<td class="price">{{ formatPrice(order.paymentAmount, order.currencyCode) }}</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
</div>

{% if order.transactions | length %}
	<div class="panel panel-default">
		<div class="panel-heading">
			<h2 class="panel-title">
				<span class="glyphicon glyphicon-credit-card"></span>
				{{ i18n('m.rbs.order.front.order_payment', ['ucf']) }}
			</h2>
		</div>
		<div class="table-responsive">
			<table class="table table-striped table-vertical-middle no-bottom-margin">
				<thead>
					<tr>
						<th>{{ i18n('m.rbs.order.front.transaction_connector', ['ucf']) }}</th>
						<th>{{ i18n('m.rbs.order.front.transaction_amount', ['ucf']) }}</th>
						<th>{{ i18n('m.rbs.order.front.transaction_status', ['ucf']) }}</th>
						<th>{{ i18n('m.rbs.order.front.transaction_date', ['ucf']) }}</th>
					</tr>
				</thead>
				<tbody>
					{% for transaction in order.transactions %}
						<tr>
							<td>{{ transaction.connectorTitle }}</td>
							<td>{{ formatPrice(transaction.amount, transaction.currencyCode) }}</td>
							<td>{{ i18n('m.rbs.order.front.transaction_status_' ~ transaction.processingStatus, ['ucf']) }}</td>
							<td>
								{% if transaction.processingDate %}
									{{ transaction.processingDate | transDateTime }}
								{% else %}
									-
								{% endif %}
							</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
{% endif %}

{% if order.shipments | length %}
	<div class="panel panel-default">
		<div class="panel-heading">
			<h2 class="panel-title">
				<span class="glyphicon glyphicon-envelope"></span>
				{{ i18n('m.rbs.order.front.order_shipments', ['ucf']) }}
			</h2>
		</div>
		<div class="table-responsive">
			<table class="table table-striped table-vertical-middle no-bottom-margin">
				<thead>
					<tr>
						<th>{{ i18n('m.rbs.order.front.shipment_code', ['ucf']) }}</th>
						<th>{{ i18n('m.rbs.order.front.shipment_articles', ['ucf']) }}</th>
						<th>{{ i18n('m.rbs.order.front.shipment_carrier_infos', ['ucf']) }}</th>
						<th>{{ i18n('m.rbs.order.front.shipment_address', ['ucf']) }}</th>
					</tr>
				</thead>
				<tbody>
					{% for shipment in order.shipments %}
						<tr>
							<td>{{ shipment.code }}</td>
							<td>
								{% for line in shipment.lines %}
									{{ line.quantity }} x {{ line.label }}<br />
								{% endfor %}
							</td>
							<td>
								{{ shipment.shippingModeCode }}
								{% if shipment.trackingCode %}
									<br />
									{% if shipment.trackingUrl %}
										<a href="{{ shipment.trackingUrl }}">{{ shipment.trackingCode }}</a>
									{% else %}
										{{ shipment.trackingCode }}
									{% endif %}
								{% endif %}
								{% if shipment.carrierStatus %}<br />{{ shipment.carrierStatus }}{% endif %}
							</td>
							<td>
								{% if shipment.address.lines|length %}
									{% set lines = shipment.address.lines %}
									<address class="no-bottom-margin">
										<strong>{{ lines[0] }}</strong>
										{% for line in lines %}
											{% if not loop.first %}<br />{{ line }}{% endif %}
										{% endfor %}
									</address>
								{% else %}
									-
								{% endif %}
							</td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
{% endif %}

{% if orderData.returns | length %}
	<div id="return-list-{{ blockId }}" data-ng-controller="RbsProductreturnReturnListController">
		<div data-ng-show="pleaseWait">
			<div class="modal-backdrop in"></div>
			<div class="modal" style="display: block;">
				<div class="modal-dialog">
					<div class="modal-content text-center well">
						<p>{{ i18n('m.rbs.productreturn.front.please_wait_ongoing_treatment', ['ucf', 'etc']) | raw }}</p>
						<img alt="" src="data:image/gif;base64,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" />
					</div>
				</div>
			</div>
		</div>

		{% for return in orderData.returns %}
			{% block returnDetails %}
				{% include 'Rbs_Productreturn/return-details.twig' with {'return': return, 'blockId': blockId, 'showOrderLink': false} %}
			{% endblock returnDetails %}

			{% block returnSeparator %}
				{% if not loop.last %}
					<hr />
				{% endif %}
			{% endblock returnSeparator %}
		{% endfor %}
	</div>
{% endif %}