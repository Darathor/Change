<form name="form" ng-submit="submit()" class="form-horizontal">
	<fieldset data-ng-show="section==''"
		data-form-section-label="{{ i18nAttr('m.rbs.admin.general-properties', ['ucf']) }}"
		data-form-section-group="{{ i18nAttr('m.rbs.admin.properties', ['ucf']) }}">

		<div data-ng-if="document.isNew()">
			<rbs-field-picker required="true" property="declinedProduct"
					label="{{ i18nAttr('m.rbs.catalog.document.declinationgroup.declinedproduct', ['ucf']) }}"
					accepted-model="Rbs_Catalog_Product"
					selector-title="{{ i18nAttr('m.rbs.catalog.document.declinationgroup.declinedproduct-picker-title', ['ucf']) }}"
					allow-creation="true"
					allow-edition="false"
					picker-template="picker-empty-group.twig">
			</rbs-field-picker>

			<rbs-field required="true" property="axeAttribute"
					label="{{ i18nAttr('m.rbs.catalog.document.declinationgroup.axeattribute', ['ucf']) }}">
				<select ng-required="true" ng-model="document.axeAttribute"
						rbs-items-from-collection="Rbs_Catalog_Collection_AttributeSet" rbs-items-collection-params="visibility:axes">
					<option value="">{{ i18n('m.rbs.admin.forms.picker-choose', ['ucf']) }}</option>
				</select>
			</rbs-field>
		</div>

		<div class="control-group" data-ng-hide="document.isNew()">
			<label class="control-label">{{ i18n('m.rbs.catalog.document.declinationgroup.declinedproduct', ['ucf']) }}</label>
			<div class="controls">
				<a href ng-href="(= document.declinedProduct | documentURL =)">(= document.declinedProduct.label =)</a>
			</div>
		</div>

		<rbs-field-boolean property="newSkuOnCreation"
				label="{{ i18nAttr('m.rbs.catalog.document.declinationgroup.newskuoncreation', ['ucf']) }}">
		</rbs-field-boolean>

		<div data-ng-if="!document.isNew()">
			<div class="control-group property" property="axesInfo"
					label="{{ i18nAttr('m.rbs.catalog.document.declinationgroup.axesinfo', ['ucf']) }}">
				<table class="table">
					<thead>
						<tr>
							<th>{{ i18n('m.rbs.catalog.document.declinationgroup.axe-head', ['ucf']) }}</th>
							<th>{{ i18n('m.rbs.catalog.document.declinationgroup.visibility-head', ['ucf']) }}</th>
							<th>{{ i18n('m.rbs.catalog.document.declinationgroup.values-head', ['ucf']) }}</th>
						</tr>
					</thead>
					<tbody>
						<tr data-ng-repeat="axeInfo in document.axesInfo">
							<td>
								(= getAxeTitle(axeInfo.id) =)
							</td>
							<td>
								<switch ng-model="axeInfo.cat"></switch>
							</td>
							<td>
								<div class="input-prepend">
									<button class="btn" type="button" ng-click="addAxeDefaultValue(axeInfo)"><i class="icon-plus-sign"> </i></button>
									<input type="text" class="input-small" data-ng-model="axeDefaultValue[axeInfo.id]">
								</div><br />
								<span data-ng-repeat="value in axeInfo.dv">
									<a href ng-click="removeAxeDefaultValue(axeInfo, value)"><i class="icon-minus-sign"> </i>(= value.title =)</a>
									<span data-ng-hide="$last">, </span>
								</span>
							</td>
						</tr>
					</tbody>
				</table>
				<button class="btn btn-small btn-warning" ng-click="addAllProduct()" type="button">{{ i18n('m.rbs.catalog.document.declinationgroup.generate-all-action', ['ucf']) }}</button>
			</div>
			<hr />

			<div class="control-group property" property="productMatrixInfo"
					label="{{ i18nAttr('m.rbs.catalog.document.declinationgroup.productmatrixinfo', ['ucf']) }}">

				<div data-ng-show="declinationPath.length">
					<a href ng-click="selectDeclinationId(document.declinedProduct.id)">
						(= document.label =)</a> -
						<span data-ng-repeat="declination in declinationPath">
							<a href ng-click="selectDeclinationId(declination.id)" data-ng-hide="$last">
								(= getAxeTitle(declination.axeId) =) : (= getAxeValueTitle(declination.axeId, declination.axeValue) =)
							</a>
							<span data-ng-hide="$last"> - </span>
							<span data-ng-show="$last">
								(= getAxeTitle(declination.axeId) =) : (= getAxeValueTitle(declination.axeId, declination.axeValue) =)
							</span>
						</span>
				</div>

				<div data-ng-hide="declinationPath.length">
					(= document.label =)
				</div>

				<table class="table">
						<thead>
							<tr>
								<th>(= getAxeTitle(currentAxe.id) =) </th>
								<th data-ng-hide="isDeclinationMatrix()">{{ i18n('m.rbs.catalog.document.declinationgroup.edit-product-head', ['ucf']) }}</th>
								<th data-ng-show="isDeclinationMatrix()">{{ i18n('m.rbs.catalog.document.declinationgroup.edit-axe-head', ['ucf', 'lab']) }} (= nextDeclinationAxe().label =)</th>
							</tr>
						</thead>
						<tbody>
							<tr data-ng-repeat="row in matrix">
								<td>
									(= row[0].title =)
								</td>
								<td data-ng-show="row[1].declination">
									<div data-ng-switch="row[1].id">
										<a href="javascript:;" data-ng-show="row[1].id == 0" ng-click="addDeclination(row[1])">
											<i class="icon-plus-sign"> </i>
											<span data-ng-hide="row[1].removed">{{ i18n('m.rbs.catalog.document.declinationgroup.add-axe', ['ucf']) }}</span>
											<span data-ng-show="row[1].removed">{{ i18n('m.rbs.catalog.document.declinationgroup.restore-axe', ['ucf']) }}</span>
										</a>
										<a href="javascript:;" data-ng-show="row[1].id != 0" ng-click="selectDeclinationId(row[1].id)">
											<i class="icon-edit"> </i> {{ i18n('m.rbs.catalog.document.declinationgroup.edit-action', ['ucf']) }}</a>
										<a href="javascript:;" data-ng-show="row[1].id != 0" ng-click="deleteDeclination(row[1])">
											<i class="icon-minus-sign"> </i> {{ i18n('m.rbs.catalog.document.declinationgroup.delete-action', ['ucf']) }}</a>
									</div>
								</td>
								<td data-ng-hide="row[1].declination">
										<a href="javascript:;" data-ng-show="row[1].id == 0" ng-click="addDeclination(row[1])">
											<i class="icon-plus-sign"> </i>
											<span data-ng-hide="row[1].removed">{{ i18n('m.rbs.catalog.document.declinationgroup.add-product', ['ucf']) }}</span>
											<span data-ng-show="row[1].removed">{{ i18n('m.rbs.catalog.document.declinationgroup.restore-product', ['ucf']) }}</span>
										</a>
										<a href="javascript:;" data-ng-show="row[1].id > 0" ng-click="editProduct(row[1])">
											<i class="icon-edit"> </i> {{ i18n('m.rbs.catalog.document.declinationgroup.edit-action', ['ucf']) }}</a>
										<span data-ng-show="row[1].id < 0" ng-click="editProduct(row[1])">
											<i class="icon-info-sign"> </i> {{ i18n('m.rbs.catalog.document.declinationgroup.to-generate-product', ['ucf']) }}</span>
										<a href="javascript:;" data-ng-show="row[1].id != 0" ng-click="deleteDeclination(row[1])">
											<i class="icon-minus-sign"> </i> {{ i18n('m.rbs.catalog.document.declinationgroup.delete-action', ['ucf']) }}</a>
								</td>
							</tr>
							<tr>
								<td>
									<div class="input-prepend">
										<button class="btn" type="button" ng-click="addAxeDefaultValue(currentAxe.info)"><i class="icon-plus-sign"> </i></button>
										<input type="text" class="input-small" data-ng-model="axeDefaultValue[currentAxe.info.id]">
									</div>
								</td>
								<td>
									{{ i18n('m.rbs.catalog.document.declinationgroup.add-axe-value', ['ucf']) }}
								</td>
							</tr>
						</tbody>
				</table>
			</div>
		</div>
	</fieldset>

	<fieldset data-ng-show="section=='product'"
			data-form-section-label="{{ i18nAttr('m.rbs.catalog.document.declinationgroup.products-section', ['ucf']) }}"
			data-form-section-group="{{ i18nAttr('m.rbs.admin.properties', ['ucf']) }}">

		<table class="document-list table table-condensed table-bordered table-striped table-hover token">
			<thead>
			<tr>
				<th>
					{{ i18n('m.rbs.catalog.document.declinationgroup.label', ['ucf']) }}
				</th>
				<th>
					{{ i18n('m.rbs.catalog.document.product.sku', ['ucf']) }}
				</th>
			</tr>
			</thead>
			<tbody>
				<tr data-ng-repeat="product in productList" class="normal-row">
					<td>
						<a href ng-href="(= product | documentURL =)">(= product.label =)</a>
					</td>
					<td>
						<a href data-ng-show="product.sku" ng-href="(= product.sku | documentURL =)">(= product.sku.label =)</a>
					</td>
				</tr>
			</tbody>
		</table>
	</fieldset>

	<fieldset data-ng-show="section=='systeminfo'"
		data-form-section-label="{{ i18nAttr('m.rbs.admin.admin.js.status', ['ucf']) }}"
		data-form-section-group="{{ i18nAttr('m.rbs.admin.information', ['ucf']) }}"
		data-document-system-info-section>
	</fieldset>

	<form-button-bar></form-button-bar>
</form>