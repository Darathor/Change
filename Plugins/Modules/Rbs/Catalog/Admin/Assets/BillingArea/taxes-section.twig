<div class="pull-right" style="margin-top: 10px; line-height: 20px;">
	{{ i18n('m.rbs.catalog.document.billingarea.enable-deletion', ['ucf', 'lab']) }}
	<switch data-ng-model="TaxesSection.deletionMode" />
</div>

<div class="btn-toolbar">
	<form class="input-append btn-group">
		<input type="text" data-ng-model="TaxesSection.newTaxCode" class="input-mini" />
		<button class="btn btn-info" ng-click="TaxesSection.addTax()" type="submit">
			<i class="icon-plus"></i> {{ i18n('m.rbs.catalog.document.tax', ['ucf']) }}
		</button>
	</form>
</div>

<rbs-todo>Forcer à avoir au moins une zone et une catégorie par taxe ainsi qu'une zone par défaut.</rbs-todo>

<div class="accordion" id="taxes-accordion">
	<div class="accordion-group" data-ng-repeat="(taxIndex, tax) in document.taxesData">
		<div class="accordion-heading" onclick="jQuery('#collapse-(= taxIndex =)').toggle()">
			<span class="accordion-toggle">(= tax.code =)</span>
		</div>
		<div id="collapse-(= taxIndex =)" class="accordion-body collapse in">
			<div class="accordion-inner">
				<div class="btn-toolbar">
					<form class="input-append btn-group">
						<input type="text" data-ng-model="TaxesSection.newCategoryCode" class="input-mini" />
						<button class="btn btn-info" ng-click="TaxesSection.addCategory(tax)" type="submit">
							<i class="icon-plus"></i> {{ i18n('m.rbs.catalog.document.billingarea.tax-category', ['ucf']) }}
						</button>
					</form>
					<form class="input-append btn-group">
						<select data-ng-model="TaxesSection.newZoneCode" class="input-medium">
							<option value="">...</option>
							<option data-ng-repeat="zone in TaxesSection.zones" value="(= zone.code =)">(= zone.code =)</option>
						</select>
						<button class="btn btn-info" ng-click="TaxesSection.addZone(tax)" type="submit">
							<i class="icon-plus"></i> {{ i18n('m.rbs.catalog.document.billingarea.tax-zone', ['ucf']) }}
						</button>
					</form>

					<button class="btn pull-right" ng-click="TaxesSection.moveTaxDown(taxIndex)" ng-show="taxIndex < document.taxesData.length - 1" type="button">
						<i class="icon-arrow-down icon-white"></i> {{ i18n('m.rbs.admin.move-down', ['ucf']) }}
					</button>
					<button class="btn pull-right disabled" ng-show="taxIndex == document.taxesData.length - 1" type="button">
						<i class="icon-arrow-down icon-white"></i> {{ i18n('m.rbs.admin.move-down', ['ucf']) }}
					</button>
					<button class="btn pull-right" ng-click="TaxesSection.moveTaxUp(taxIndex)" ng-show="taxIndex > 0" type="button">
						<i class="icon-arrow-up icon-white"></i> {{ i18n('m.rbs.admin.move-up', ['ucf']) }}
					</button>
					<button class="btn pull-right disabled" ng-show="taxIndex == 0" type="button">
						<i class="icon-arrow-up icon-white"></i> {{ i18n('m.rbs.admin.move-up', ['ucf']) }}
					</button>
					<button class="btn btn-danger pull-right" ng-show="TaxesSection.deletionMode" ng-click="TaxesSection.removeTax(taxIndex)" type="button">
						<i class="icon-trash icon-white"></i> {{ i18n('m.rbs.admin.admin.js.delete', ['ucf']) }}
					</button>
				</div>

				<table class="table table-striped table-bordered">
					<thead>
						<tr>
							<th></th>
							<th style="text-align: center;" data-ng-repeat="(categoryIndex, category) in tax.categories">
								(= category.code =)
								<button class="btn btn-danger btn-mini" ng-show="TaxesSection.deletionMode" ng-click="TaxesSection.removeCategory(tax, categoryIndex)" type="button">
									<i class="icon-trash icon-white"></i>
								</button>
							</th>
						</tr>
					</thead>
					<tbody>
						<tr data-ng-repeat="(lineIndex, line) in tax.ratesByZone">
							<th>
								(= line.zone.code =)
								<button class="btn btn-danger btn-mini" ng-show="TaxesSection.deletionMode" ng-click="TaxesSection.removeZone(tax, lineIndex)" type="button">
									<i class="icon-trash icon-white"></i>
								</button>
							</th>
							<td style="text-align: center;" data-ng-repeat="rate in line.rates">
								<div class="input-append">
									<input type="number" data-ng-model="rate.value" style="width: 40px" />
									<span class="add-on">%</span>
								</div>
							</td>
						</tr>
					</tbody>
				</table>

				<div class="control-group required">
					<label class="control-label" for="defaultZone-(= taxIndex =)">
						{{ i18n('m.rbs.catalog.document.tax.defaultzone', ['ucf']) }}
					</label>
					<div class="controls">
						<select data-ng-model="tax.defaultZone" class="input-medium" id="defaultZone-(= taxIndex =)"
							ng-options="line.zone.code as line.zone.code for line in tax.ratesByZone">
						</select>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
