<div data-ng-controller="Rbs_Website_Topic_ListController">
	<page-header sub-title="{{ i18nAttr('m.rbs.website.document.topic-list', ['ucf']) }}"></page-header>

	<search-filters model="Rbs_Website_StaticPage" filter-query="query" text-search="textSearch"></search-filters>

	<div>
		<span class="pull-right">
			<span ng-if="currentFolder.is('Rbs_Website_Website')"><a href ng-href="(= currentFolder | documentURL:'menus':true =)"><i class="icon-list-alt"></i> {{ i18n('m.rbs.website.document.topic.menus', ['ucf']) }}</a> |</span>
			<a href ng-click="toggleFunctions($event)"><i ng-class="{'icon-spinner icon-spin':loadingFunctions, 'icon-chevron-up':showFunctions, 'icon-chevron-down':! showFunctions}"></i> {{ i18n('m.rbs.website.document.topic.functions', ['ucf']) }}</a> |
			<a href ng-href="(= currentFolder | documentURL:'form' =)"><i class="icon-pencil"></i> {{ i18n('m.rbs.website.document.topic.properties', ['ucf']) }}</a>
		</span>

		<a href ng-href="(= 'Rbs_Website_StaticPage' | documentURL:'new'=)">{{ i18n('m.rbs.website.document.staticpage-create', ['ucf']) }}</a>
		|
		<a href ng-href="(= 'Rbs_Website_Topic' | documentURL:'new'=)">{{ i18n('m.rbs.website.document.topic-create', ['ucf']) }}</a>
	</div>

	<div ng-if="sectionFunctions && showFunctions" class="well well-small">
		<button class="close pull-right" type="button" ng-click="toggleFunctions($event, false)">&times;</button>
		<h5 ng-show="! loadingFunctions" ng-pluralize count="sectionFunctions.length" when="{{ i18n('m.rbs.website.document.topic.section-functions', ['ucf']) }}"></h5>
		<ul>
			<li ng-repeat="f in sectionFunctions"><strong>(= f.functionLabel =)</strong> <span class="muted">((= f.functionCode =))</span><br/>{{ i18n('m.rbs.website.document.topic.function-via-page') }} <a href ng-href="(= f.page | documentURL =)">(= f.page.label =)</a></li>
		</ul>
		<div>
			<a href ng-href="(= currentSection | documentURL:'functions':true =)"><i class="icon-cog"></i> {{ i18n('m.rbs.website.document.topic.configure-section-functions-link', ['ucf']) }}</a>
		</div>
	</div>

	<rbs-document-list data-dlid="DLRbsWebsiteTopicList"
	               publishable="true"
	               tree="Rbs_Website"
	               extend="listExtend"
	               filter-query="query">

		<quick-actions>
			[action default]
			<span ng-if="doc.is('Rbs_Website_Topic')">
				|| <a href ng-href="(= doc | documentURL:'functions':true =)">
					<i class="icon-cog"></i> {{ i18n('m.rbs.website.document.topic.functions') }}
				</a>
				|| <a href="(= doc | documentURL : 'permission' =)">{{ i18nAttr('m.rbs.website.document.topic.permission') }}</a>
			</span>
		</quick-actions>

		<column name="icon" width="30px" align="center">
			<span ng-if="doc.is('Rbs_Website_Topic') && doc.nodeHasChildren()" class="iconoverlay" title="Éléments dans cette rubrique : (=doc.nodeChildrenCount()=)">
				<i class="icon-2x icon-folder-close"></i>
				<label>(=doc.nodeChildrenCount() | maxNumber=)</label>
			</span>
			<i ng-if="doc.is('Rbs_Website_Topic') && ! doc.nodeHasChildren()" class="icon-2x icon-folder-close-alt"></i>
			<span ng-if="doc.is('Rbs_Website_StaticPage')" class="iconoverlay">
				<i class="icon-2x icon-file"></i>
			</span>
		</column>

		<column name="label" label="Libellé" primary="true">
			<strong ng-if="doc.is('Rbs_Website_StaticPage')"><a href ng-href="(= doc | documentURL:'form' =)">(=doc.label=)</a></strong>
			<span ng-if="doc.is('Rbs_Website_Topic')"><strong><a title="Naviguer vers le contenu de la rubrique"
			   href ng-href="(= doc | documentURL:'tree' =)">(=doc.label=)</a></strong>
				<i class="icon-rbs-navigate-to"></i>
			</span>
		</column>

		<column name="functions" width="32px" label="Index">
			<button type="button" class="btn" ng-disabled="busy" ng-if="doc.is('Rbs_Website_StaticPage')" ng-class="{'btn-success':extend.isIndexPage(doc)}" ng-click="extend.setIndexPage(doc)">
				<i ng-class="{true: 'icon-circle', false: 'icon-circle-blank'}[extend.isIndexPage(doc)]"></i>
			</button>

		</column>

	</rbs-document-list>
</div>